- name: Clean management location
  ansible.builtin.file:
    path: /beegfs_data/mgmt
    state: absent
  become: true
  become_user: root
- name: Create management location
  ansible.builtin.file:
    path: /beegfs_data/mgmt
    state: directory
  become: true
  become_user: root
- name: Configure management
  ansible.builtin.command:
    cmd: /opt/beegfs/sbin/beegfs-setup-mgmtd -p /beegfs_data/mgmt
  become: true
  become_user: root
- name: fix manangement conf
  ansible.builtin.replace:
    path: /etc/beegfs/beegfs-mgmtd.conf
    regexp: 'connAuthFile[ \t]+='
    replace: 'connAuthFile=/etc/beegfs/connauthfile'
  become: true
  become_user: root
- name: start mgmtd
  ansible.builtin.systemd_service:
    name: beegfs-mgmtd
    state: started
    enabled: true
  become: true
  become_user: root